import{e as Fe,r as Z,p as Ue,v as Be,c as it,o as Ne,a as J,z as S,_ as st,m as at,s as rt,g as lt}from"./D4ANIz5k.js";import{n as ct,g as c,Q as q,R as ht,o as Ee,c as Ve,L as pt,p as Q,B as A,i as Ye,F as Te,M as s,q as we,r as B,s as le,e as ut,E as dt,t as Ke,b as _e,D as Ie,f as Le,W as mt,u as ft,S as wt,P as yt,T as vt,G as ke,h as Ze,v as He,d as gt,m as _t,H as xt,k as je}from"./BD8dNJ6u.js";import{u as Re}from"./Cz3nu93G.js";import{O as bt}from"./DhYVZotJ.js";import{s as Pt}from"./DfDmfrbP.js";const ee=new ht,M=new c,N=new c,w=new q,ze={X:new c(1,0,0),Y:new c(0,1,0),Z:new c(0,0,1)},Se={type:"change"},De={type:"mouseDown",mode:null},Ce={type:"mouseUp",mode:null},We={type:"objectChange"};class St extends ct{constructor(i,t=null){super(void 0,t);const o=new Qt(this);this._root=o;const n=new Yt;this._gizmo=n,o.add(n);const l=new Tt;this._plane=l,o.add(l);const e=this;function a(x,j){let k=j;Object.defineProperty(e,x,{get:function(){return k!==void 0?k:j},set:function(D){k!==D&&(k=D,l[x]=D,n[x]=D,e.dispatchEvent({type:x+"-changed",value:D}),e.dispatchEvent(Se))}}),e[x]=j,l[x]=j,n[x]=j}a("camera",i),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const y=new c,H=new c,E=new q,O=new q,g=new c,z=new q,Y=new c,d=new c,T=new c,I=0,L=new c;a("worldPosition",y),a("worldPositionStart",H),a("worldQuaternion",E),a("worldQuaternionStart",O),a("cameraPosition",g),a("cameraQuaternion",z),a("pointStart",Y),a("pointEnd",d),a("rotationAxis",T),a("rotationAngle",I),a("eye",L),this._offset=new c,this._startNorm=new c,this._endNorm=new c,this._cameraScale=new c,this._parentPosition=new c,this._parentQuaternion=new q,this._parentQuaternionInv=new q,this._parentScale=new c,this._worldScaleStart=new c,this._worldQuaternionInv=new q,this._worldScale=new c,this._positionStart=new c,this._quaternionStart=new q,this._scaleStart=new c,this._getPointer=Mt.bind(this),this._onPointerDown=It.bind(this),this._onPointerHover=Et.bind(this),this._onPointerMove=At.bind(this),this._onPointerUp=Xt.bind(this),t!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(i){if(this.object===void 0||this.dragging===!0)return;i!==null&&ee.setFromCamera(i,this.camera);const t=Me(this._gizmo.picker[this.mode],ee);t?this.axis=t.object.name:this.axis=null}pointerDown(i){if(!(this.object===void 0||this.dragging===!0||i!=null&&i.button!==0)&&this.axis!==null){i!==null&&ee.setFromCamera(i,this.camera);const t=Me(this._plane,ee,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,De.mode=this.mode,this.dispatchEvent(De)}}pointerMove(i){const t=this.axis,o=this.mode,n=this.object;let l=this.space;if(o==="scale"?l="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(l="world"),n===void 0||t===null||this.dragging===!1||i!==null&&i.button!==-1)return;i!==null&&ee.setFromCamera(i,this.camera);const e=Me(this._plane,ee,!0);if(e){if(this.pointEnd.copy(e.point).sub(this.worldPositionStart),o==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),l==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),l==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(l==="local"&&(n.position.applyQuaternion(w.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),l==="world"&&(n.parent&&n.position.add(M.setFromMatrixPosition(n.parent.matrixWorld)),t.search("X")!==-1&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(M.setFromMatrixPosition(n.parent.matrixWorld))));else if(o==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),N.set(a,a,a)}else M.copy(this.pointStart),N.copy(this.pointEnd),M.applyQuaternion(this._worldQuaternionInv),N.applyQuaternion(this._worldQuaternionInv),N.divide(M),t.search("X")===-1&&(N.x=1),t.search("Y")===-1&&(N.y=1),t.search("Z")===-1&&(N.z=1);n.scale.copy(this._scaleStart).multiply(N),this.scaleSnap&&(t.search("X")!==-1&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(M.setFromMatrixPosition(this.camera.matrixWorld));let y=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(M.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(ze[t]),M.copy(ze[t]),l==="local"&&M.applyQuaternion(this.worldQuaternion),M.cross(this.eye),M.length()===0?y=!0:this.rotationAngle=this._offset.dot(M.normalize())*a),(t==="E"||y)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),l==="local"&&t!=="E"&&t!=="XYZE"?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(w.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(w.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(Se),this.dispatchEvent(We)}}pointerUp(i){i!==null&&i.button!==0||(this.dragging&&this.axis!==null&&(Ce.mode=this.mode,this.dispatchEvent(Ce)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this.traverse(function(i){i.geometry&&i.geometry.dispose(),i.material&&i.material.dispose()})}attach(i){return this.object=i,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(Se),this.dispatchEvent(We),this.pointStart.copy(this.pointEnd))}getRaycaster(){return ee}getMode(){return this.mode}setMode(i){this.mode=i}setTranslationSnap(i){this.translationSnap=i}setRotationSnap(i){this.rotationSnap=i}setScaleSnap(i){this.scaleSnap=i}setSize(i){this.size=i}setSpace(i){this.space=i}}function Mt(m){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:m.button};{const i=this.domElement.getBoundingClientRect();return{x:(m.clientX-i.left)/i.width*2-1,y:-(m.clientY-i.top)/i.height*2+1,button:m.button}}}function Et(m){if(this.enabled)switch(m.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(m));break}}function It(m){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(m.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(m)),this.pointerDown(this._getPointer(m)))}function At(m){this.enabled&&this.pointerMove(this._getPointer(m))}function Xt(m){this.enabled&&(this.domElement.releasePointerCapture(m.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(m)))}function Me(m,i,t){const o=i.intersectObject(m,!0);for(let n=0;n<o.length;n++)if(o[n].object.visible||t)return o[n];return!1}const ye=new dt,u=new c(0,1,0),qe=new c(0,0,0),Ge=new Ke,ve=new q,xe=new q,W=new c,Oe=new Ke,pe=new c(1,0,0),te=new c(0,1,0),ue=new c(0,0,1),ge=new c,ce=new c,he=new c;class Qt extends Ee{constructor(i){super(),this.isTransformControlsRoot=!0,this.controls=i,this.visible=!1}updateMatrixWorld(i){const t=this.controls;t.object!==void 0&&(t.object.updateMatrixWorld(),t.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):t.object.parent.matrixWorld.decompose(t._parentPosition,t._parentQuaternion,t._parentScale),t.object.matrixWorld.decompose(t.worldPosition,t.worldQuaternion,t._worldScale),t._parentQuaternionInv.copy(t._parentQuaternion).invert(),t._worldQuaternionInv.copy(t.worldQuaternion).invert()),t.camera.updateMatrixWorld(),t.camera.matrixWorld.decompose(t.cameraPosition,t.cameraQuaternion,t._cameraScale),t.camera.isOrthographicCamera?t.camera.getWorldDirection(t.eye).negate():t.eye.copy(t.cameraPosition).sub(t.worldPosition).normalize(),super.updateMatrixWorld(i)}}class Yt extends Ee{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const i=new Ve({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new pt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),o=i.clone();o.opacity=.15;const n=t.clone();n.opacity=.5;const l=i.clone();l.color.setHex(16711680);const e=i.clone();e.color.setHex(65280);const a=i.clone();a.color.setHex(255);const y=i.clone();y.color.setHex(16711680),y.opacity=.5;const H=i.clone();H.color.setHex(65280),H.opacity=.5;const E=i.clone();E.color.setHex(255),E.opacity=.5;const O=i.clone();O.opacity=.25;const g=i.clone();g.color.setHex(16776960),g.opacity=.25,i.clone().color.setHex(16776960);const Y=i.clone();Y.color.setHex(7895160);const d=new Q(0,.04,.1,12);d.translate(0,.05,0);const T=new A(.08,.08,.08);T.translate(0,.04,0);const I=new Ye;I.setAttribute("position",new Te([0,0,0,1,0,0],3));const L=new Q(.0075,.0075,.5,3);L.translate(0,.25,0);function x(X,K){const v=new le(X,.0075,3,64,K*Math.PI*2);return v.rotateY(Math.PI/2),v.rotateX(Math.PI/2),v}function j(){const X=new Ye;return X.setAttribute("position",new Te([0,0,0,1,1,1],3)),X}const k={X:[[new s(d,l),[.5,0,0],[0,0,-Math.PI/2]],[new s(d,l),[-.5,0,0],[0,0,Math.PI/2]],[new s(L,l),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new s(d,e),[0,.5,0]],[new s(d,e),[0,-.5,0],[Math.PI,0,0]],[new s(L,e)]],Z:[[new s(d,a),[0,0,.5],[Math.PI/2,0,0]],[new s(d,a),[0,0,-.5],[-Math.PI/2,0,0]],[new s(L,a),null,[Math.PI/2,0,0]]],XYZ:[[new s(new we(.1,0),O.clone()),[0,0,0]]],XY:[[new s(new A(.15,.15,.01),E.clone()),[.15,.15,0]]],YZ:[[new s(new A(.15,.15,.01),y.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new A(.15,.15,.01),H.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},D={X:[[new s(new Q(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new s(new Q(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new s(new Q(.2,0,.6,4),o),[0,.3,0]],[new s(new Q(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new s(new Q(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new s(new Q(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new s(new we(.2,0),o)]],XY:[[new s(new A(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new s(new A(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new A(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]]},ne={START:[[new s(new we(.01,2),n),null,null,null,"helper"]],END:[[new s(new we(.01,2),n),null,null,null,"helper"]],DELTA:[[new B(j(),n),null,null,null,"helper"]],X:[[new B(I,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new B(I,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new B(I,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},V={XYZE:[[new s(x(.5,1),Y),null,[0,Math.PI/2,0]]],X:[[new s(x(.5,.5),l)]],Y:[[new s(x(.5,.5),e),null,[0,0,-Math.PI/2]]],Z:[[new s(x(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new s(x(.75,1),g),null,[0,Math.PI/2,0]]]},de={AXIS:[[new B(I,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},se={XYZE:[[new s(new ut(.25,10,8),o)]],X:[[new s(new le(.5,.1,4,24),o),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new s(new le(.5,.1,4,24),o),[0,0,0],[Math.PI/2,0,0]]],Z:[[new s(new le(.5,.1,4,24),o),[0,0,0],[0,0,-Math.PI/2]]],E:[[new s(new le(.75,.1,2,24),o)]]},G={X:[[new s(T,l),[.5,0,0],[0,0,-Math.PI/2]],[new s(L,l),[0,0,0],[0,0,-Math.PI/2]],[new s(T,l),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new s(T,e),[0,.5,0]],[new s(L,e)],[new s(T,e),[0,-.5,0],[0,0,Math.PI]]],Z:[[new s(T,a),[0,0,.5],[Math.PI/2,0,0]],[new s(L,a),[0,0,0],[Math.PI/2,0,0]],[new s(T,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new s(new A(.15,.15,.01),E),[.15,.15,0]]],YZ:[[new s(new A(.15,.15,.01),y),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new A(.15,.15,.01),H),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new s(new A(.1,.1,.1),O.clone())]]},me={X:[[new s(new Q(.2,0,.6,4),o),[.3,0,0],[0,0,-Math.PI/2]],[new s(new Q(.2,0,.6,4),o),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new s(new Q(.2,0,.6,4),o),[0,.3,0]],[new s(new Q(.2,0,.6,4),o),[0,-.3,0],[0,0,Math.PI]]],Z:[[new s(new Q(.2,0,.6,4),o),[0,0,.3],[Math.PI/2,0,0]],[new s(new Q(.2,0,.6,4),o),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new s(new A(.2,.2,.01),o),[.15,.15,0]]],YZ:[[new s(new A(.2,.2,.01),o),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new s(new A(.2,.2,.01),o),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new s(new A(.2,.2,.2),o),[0,0,0]]]},be={X:[[new B(I,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new B(I,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new B(I,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function R(X){const K=new Ee;for(const v in X)for(let F=X[v].length;F--;){const b=X[v][F][0].clone(),oe=X[v][F][1],ie=X[v][F][2],U=X[v][F][3],fe=X[v][F][4];b.name=v,b.tag=fe,oe&&b.position.set(oe[0],oe[1],oe[2]),ie&&b.rotation.set(ie[0],ie[1],ie[2]),U&&b.scale.set(U[0],U[1],U[2]),b.updateMatrix();const ae=b.geometry.clone();ae.applyMatrix4(b.matrix),b.geometry=ae,b.renderOrder=1/0,b.position.set(0,0,0),b.rotation.set(0,0,0),b.scale.set(1,1,1),K.add(b)}return K}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=R(k)),this.add(this.gizmo.rotate=R(V)),this.add(this.gizmo.scale=R(G)),this.add(this.picker.translate=R(D)),this.add(this.picker.rotate=R(se)),this.add(this.picker.scale=R(me)),this.add(this.helper.translate=R(ne)),this.add(this.helper.rotate=R(de)),this.add(this.helper.scale=R(be)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(i){const o=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:xe;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let l=0;l<n.length;l++){const e=n[l];e.visible=!0,e.rotation.set(0,0,0),e.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),e.scale.set(1,1,1).multiplyScalar(a*this.size/4),e.tag==="helper"){e.visible=!1,e.name==="AXIS"?(e.visible=!!this.axis,this.axis==="X"&&(w.setFromEuler(ye.set(0,0,0)),e.quaternion.copy(o).multiply(w),Math.abs(u.copy(pe).applyQuaternion(o).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="Y"&&(w.setFromEuler(ye.set(0,0,Math.PI/2)),e.quaternion.copy(o).multiply(w),Math.abs(u.copy(te).applyQuaternion(o).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="Z"&&(w.setFromEuler(ye.set(0,Math.PI/2,0)),e.quaternion.copy(o).multiply(w),Math.abs(u.copy(ue).applyQuaternion(o).dot(this.eye))>.9&&(e.visible=!1)),this.axis==="XYZE"&&(w.setFromEuler(ye.set(0,Math.PI/2,0)),u.copy(this.rotationAxis),e.quaternion.setFromRotationMatrix(Ge.lookAt(qe,u,te)),e.quaternion.multiply(w),e.visible=this.dragging),this.axis==="E"&&(e.visible=!1)):e.name==="START"?(e.position.copy(this.worldPositionStart),e.visible=this.dragging):e.name==="END"?(e.position.copy(this.worldPosition),e.visible=this.dragging):e.name==="DELTA"?(e.position.copy(this.worldPositionStart),e.quaternion.copy(this.worldQuaternionStart),M.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),M.applyQuaternion(this.worldQuaternionStart.clone().invert()),e.scale.copy(M),e.visible=this.dragging):(e.quaternion.copy(o),this.dragging?e.position.copy(this.worldPositionStart):e.position.copy(this.worldPosition),this.axis&&(e.visible=this.axis.search(e.name)!==-1));continue}e.quaternion.copy(o),this.mode==="translate"||this.mode==="scale"?(e.name==="X"&&Math.abs(u.copy(pe).applyQuaternion(o).dot(this.eye))>.99&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="Y"&&Math.abs(u.copy(te).applyQuaternion(o).dot(this.eye))>.99&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="Z"&&Math.abs(u.copy(ue).applyQuaternion(o).dot(this.eye))>.99&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="XY"&&Math.abs(u.copy(ue).applyQuaternion(o).dot(this.eye))<.2&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="YZ"&&Math.abs(u.copy(pe).applyQuaternion(o).dot(this.eye))<.2&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1),e.name==="XZ"&&Math.abs(u.copy(te).applyQuaternion(o).dot(this.eye))<.2&&(e.scale.set(1e-10,1e-10,1e-10),e.visible=!1)):this.mode==="rotate"&&(ve.copy(o),u.copy(this.eye).applyQuaternion(w.copy(o).invert()),e.name.search("E")!==-1&&e.quaternion.setFromRotationMatrix(Ge.lookAt(this.eye,qe,te)),e.name==="X"&&(w.setFromAxisAngle(pe,Math.atan2(-u.y,u.z)),w.multiplyQuaternions(ve,w),e.quaternion.copy(w)),e.name==="Y"&&(w.setFromAxisAngle(te,Math.atan2(u.x,u.z)),w.multiplyQuaternions(ve,w),e.quaternion.copy(w)),e.name==="Z"&&(w.setFromAxisAngle(ue,Math.atan2(u.y,u.x)),w.multiplyQuaternions(ve,w),e.quaternion.copy(w))),e.visible=e.visible&&(e.name.indexOf("X")===-1||this.showX),e.visible=e.visible&&(e.name.indexOf("Y")===-1||this.showY),e.visible=e.visible&&(e.name.indexOf("Z")===-1||this.showZ),e.visible=e.visible&&(e.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),e.material._color=e.material._color||e.material.color.clone(),e.material._opacity=e.material._opacity||e.material.opacity,e.material.color.copy(e.material._color),e.material.opacity=e.material._opacity,this.enabled&&this.axis&&(e.name===this.axis||this.axis.split("").some(function(y){return e.name===y}))&&(e.material.color.setHex(16776960),e.material.opacity=1)}super.updateMatrixWorld(i)}}class Tt extends s{constructor(){super(new _e(1e5,1e5,2,2),new Ve({visible:!1,wireframe:!0,side:Ie,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(i){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),ge.copy(pe).applyQuaternion(t==="local"?this.worldQuaternion:xe),ce.copy(te).applyQuaternion(t==="local"?this.worldQuaternion:xe),he.copy(ue).applyQuaternion(t==="local"?this.worldQuaternion:xe),u.copy(ce),this.mode){case"translate":case"scale":switch(this.axis){case"X":u.copy(this.eye).cross(ge),W.copy(ge).cross(u);break;case"Y":u.copy(this.eye).cross(ce),W.copy(ce).cross(u);break;case"Z":u.copy(this.eye).cross(he),W.copy(he).cross(u);break;case"XY":W.copy(he);break;case"YZ":W.copy(ge);break;case"XZ":u.copy(he),W.copy(ce);break;case"XYZ":case"E":W.set(0,0,0);break}break;case"rotate":default:W.set(0,0,0)}W.length()===0?this.quaternion.copy(this.cameraQuaternion):(Oe.lookAt(M.set(0,0,0),W,u),this.quaternion.setFromRotationMatrix(Oe)),super.updateMatrixWorld(i)}}const Lt=`#define GLSLIFY 1
varying vec2 vUv;

void main() {
  vUv = uv;

  gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);
}`,kt=`precision highp float;
#define GLSLIFY 1

uniform sampler2D uTexture;

varying vec2 vUv;

void main() {
  vec2 coord = vUv;
  vec4 color = texture2D(uTexture, coord);

  if(color.a < 0.5) {
    discard;
  }

  gl_FragColor = color;
}`,Zt=Fe({__name:"Kuji",setup(m){const i=Z(null),t=Z(null),o=Z(new Le(window.innerWidth,window.innerHeight)),n={xPos:0,progress:0},l=Z(null),e=Z(null),a=Z(null),y=Z(null),H=Z(null),E=Z(!1),O=Z(!1);let g,z,Y,d,T,I,L,x,j,k,D,ne,V,de,se,G;const me=Z({scale:.0085,intensity:1.5,curve:1}),be=()=>{if(!t.value)return;g=new mt({logarithmicDepthBuffer:!0,canvas:t.value}),g.setSize(o.value.x,o.value.y),g.shadowMap.enabled=!0,g.shadowMap.type=ft,g.setPixelRatio(window.devicePixelRatio),g.setClearColor(16777215,1),z=new wt,Y=new yt(50,o.value.x/o.value.y,.1,2e3),Y.position.set(-80,-25,200),T=new bt(Y,g.domElement),T.enableDamping=!0,I=new St(Y,g.domElement),I.addEventListener("change",()=>{g.render(z,Y)}),I.addEventListener("dragging-changed",p=>{T.enabled=!p.value});const r=I.getHelper();z.add(r),X(),R()},R=()=>{const r=new vt,p=new ke;r.load(Re("/images/experiments/kuji/kuji_front.jpg"),h=>{h.wrapS=Ze,h.wrapT=Ze,L=new _e(h.image.width*.1,h.image.height*.1),x=new He({map:h,side:Ie}),j=new s(L,x),j.receiveShadow=!0,p.add(j)}),r.load(Re("/images/experiments/kuji/kuji_clip.png"),h=>{k=new _e(h.image.width*.1,h.image.height*.1,20,20),D=new He({map:h,transparent:!0,alphaTest:.5,side:Ie}),ne=new s(k,D),ne.position.set(.27715137759722996,1.2027755882334343,.1),ne.castShadow=!0,v(k,me.value.curve),V=new _e(h.image.width*.1,h.image.height*.1,20,20),de=new gt({uniforms:{time:{value:0},uTexture:{value:h},imgRatio:{value:new Le}},opacity:.5,transparent:!0,vertexShader:Lt,fragmentShader:kt}),se=new s(V,de),se.position.set(.27715137759722996,1.2027755882334343,0),v(V,me.value.curve),G=new ke,G.position.set(h.image.width*.1*.5,0,.1),G.add(ne),G.add(se),p.add(G),z.add(p),F()})},X=()=>{d=new _t(16777215,2),d.castShadow=!0,d.shadow.mapSize.width=window.innerWidth,d.shadow.mapSize.height=window.innerHeight,d.shadow.camera.left=-60,d.shadow.camera.right=60,d.shadow.camera.top=40,d.shadow.camera.bottom=-40,d.shadow.camera.near=100,d.shadow.camera.far=200,d.shadow.radius=10,d.shadow.bias=.005,d.shadow.normalBias=.05,d.position.set(0,0,150),z.add(d);const r=new xt(16777215,16777215,.5);z.add(r)},K=()=>{o.value.set(window.innerWidth,window.innerHeight),Y.aspect=o.value.x/o.value.y,Y.updateProjectionMatrix(),g.setSize(o.value.x,o.value.y)},v=(r,p)=>{const _=r.parameters.width,P=(p*p+_*_)/(2*Math.abs(p)),f=new c(0,0,P),C=new c(-_,0,0),$=new c().subVectors(C,f),$e=Math.atan2($.z,$.x),Je=Math.atan2(_,Math.abs(P)),Pe=r.attributes.position,Xe=r.attributes.uv;for(let re=0;re<Xe.count;re++){const et=Xe.getX(re),tt=Pe.getY(re),Qe=$e+Je*et,nt=f.x+P*Math.cos(Qe),ot=f.z+P*Math.sin(Qe);Pe.setXYZ(re,nt,tt,ot)}Pe.needsUpdate=!0},F=()=>{H.value=S.to(n,{duration:1,progress:.1,ease:"power2.inOut",repeat:-1,yoyo:!0,onUpdate:()=>{const p=n.progress*100;G.rotation.y=je.degToRad(p),v(k,p),v(V,p)}})},b=()=>{var _,P;const r=e.value,p=r.querySelector(".pulsate"),h=S.timeline({repeat:-1,repeatDelay:1});h.to(p,{width:150,height:150,borderRadius:200,ease:"expo.out",duration:2,autoAlpha:0,stagger:.2}),(_=i.value)==null||_.addEventListener("mousemove",f=>{if(!E.value||O.value)return;const $=f.clientX-l.value.getBoundingClientRect().left-e.value.getBoundingClientRect().width/2;S.to(n,{duration:.2,xPos:$,onUpdate:U}),f.preventDefault()}),(P=i.value)==null||P.addEventListener("mouseup",()=>{var f;E.value&&(E.value=!1,n.progress>.8?ae():((f=H.value)==null||f.resume(),h.play(),S.to(r,{duration:.5,scale:.9,ease:"expo.out"}),S.to(n,{duration:.5,xPos:0,ease:"expo.out",onUpdate:U})))}),r==null||r.addEventListener("mouseover",f=>{E.value||(S.to(r,{duration:.5,scale:.9}),f.preventDefault())}),r==null||r.addEventListener("mouseout",f=>{E.value||(S.to(r,{duration:.5,scale:1}),h.play(),f.preventDefault())}),r==null||r.addEventListener("mousedown",f=>{var C;h.pause(),(C=H.value)==null||C.pause(),S.to(h,{duration:.2,progress:0,ease:"expo.out"}),S.to(r,{scale:.5,duration:.5,ease:"expo.out"}),E.value=!0,f.preventDefault()})},oe=()=>{if(!a.value)return;const r=a.value,p=r.clientWidth,h=5;for(let _=0;_<p;_++)if(_%h===0){const P=document.createElement("span");P.classList.add("small-dot"),P.style.cssText=`
      position: absolute;
      top:0;
      left:0;
      width: 1px;
      height: 1px;
      background-color: #050505;
    `,r==null||r.append(P),S.set(P,{x:_,autoAlpha:0})}fe(!0)},ie=()=>{if(!(y!=null&&y.value))return;const r=y.value,h=r.clientWidth/2,_=360,P=10;for(let f=0;f<_;f++)if(f%P===0){const C=document.createElement("span"),$=f*Math.PI/180;C.classList.add("small-dot"),C.style.cssText=`
        position: absolute;
        top:50%;
        left:50%;
        width: 1px;
        height: 1px;
        background-color: #050505;
      `,r==null||r.append(C),S.set(C,{x:h*Math.cos($),y:h*Math.sin($)})}},U=()=>{n.progress>1&&(n.progress=1,ae()),n.progress<0&&(n.progress=0),n.xPos<0&&(n.xPos=0);const p=n.progress*100;G.rotation.y=je.degToRad(p),v(k,p),v(V,p),S.set(e.value,{x:n.xPos}),n.progress=n.xPos/a.value.clientWidth,fe(!1,n.progress)},fe=(r,p=0)=>{var _;if(!a.value)return;const h=(_=a.value)==null?void 0:_.querySelectorAll(".small-dot");h.forEach((P,f)=>{S.timeline().to(P,{autoAlpha:f/h.length<p?0:f/h.length,ease:"expo.out"},r?.01*f:0)})},ae=()=>{E.value||(E.value=!0,O.value=!0,S.to(l.value,{duration:.5,autoAlpha:0,delay:.4,ease:"expo.out"}),S.to(y.value,{duration:.5,scale:1.3,autoAlpha:0,delay:.1,ease:"expo.out"}),S.to(n,{duration:.5,xPos:a.value.clientWidth+y.value.clientWidth+.5,ease:"expo.out",onUpdate:U}))},Ae=()=>{requestAnimationFrame(Ae),g.render(z,Y)};return Ue(()=>{be(),Ae(),b(),oe(),ie(),window.addEventListener("resize",K)}),Be(()=>{window.removeEventListener("resize",K)}),(r,p)=>(Ne(),it("div",{ref_key:"kujiWrapRef",ref:i,class:"kuji-wrap"},[J("canvas",{ref_key:"kujiRef",ref:t},null,512),J("div",{ref_key:"falterIntroRef",ref:l,class:"falter-intro"},[J("div",{ref_key:"topCircleRef",ref:e,class:"top-circle"},p[0]||(p[0]=[J("div",{class:"circle main"},null,-1),J("div",{class:"pulsate circle"},null,-1)]),512),J("div",{ref_key:"connectingLineRef",ref:a,class:"connecting-line"},null,512),J("div",{ref_key:"targetCircleRef",ref:y,class:"target-circle"},null,512)],512)],512))}}),Ht=st(Zt,[["__scopeId","data-v-9b45ab4d"]]),Wt=Fe({__name:"Kuji",setup(m){const i=at(),{downloadPercent:t}=rt(i),o=Z(null),n=()=>{o.value=Pt(()=>{const l=Math.floor(Math.random()*5)+1;t.value+l>=100?(t.value=100,o.value&&clearInterval(o.value)):t.value+=l},25)};return Ue(()=>{n()}),Be(()=>{o.value&&clearInterval(o.value)}),(l,e)=>(Ne(),lt(Ht))}});export{Wt as default};
